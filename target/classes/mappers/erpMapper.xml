<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "com.erp.mappers.erp">

		<!-- 로그인 처리 -->
		<select id = "login" resultType = "Users">
				SELECT *
				FROM USERS
				WHERE user_num 	= #{user_num}
				AND user_pw 		= SHA2(#{user_pw}, 256)		
		</select>
		
		<!-- 관리자 페이지 SQL -->
		
		<!-- 부서 검색 -->
		<select id = "getDeptList" resultType = "Department">
				SELECT *
				FROM DEPARTMENT
		</select>
		
		
		<!-- users 테이블을 기준으로 각 부서에 몇명이 있는지 카운트 후 + 1	 -->
		<select id = "getDeptUserCnt" resultType = "_int">
				SELECT 	count(*) + 1
				FROM    	USERS
				WHERE 	dept_num = #{dept_num}
		</select>
		
		
		<select id = "getDepartment" resultType = "Department">
				SELECT 	*
				FROM 		DEPARTMENT
				WHERE 	dept_num = #{dept_num}
		</select>
		
		<!--  사원 리스트 불러오기 -->
		<select id = "getUsersList" resultType = "Users">
				SELECT *
				FROM USERS
				WHERE user_num NOT LIKE 'admin'
		</select>
		
		<!-- 사원등록 -->
		<insert id = "join">
		 		INSERT INTO USERS
		 		VALUES(#{user_num}, SHA2(#{user_pw},256), #{user_name}, #{dept_num}, #{user_tel}, #{user_email}, #{user_add} )
		</insert>
		
		<!-- 유저 이름 검색 -->
		<select id = "searchName" resultType = "Users">
				SELECT *
				FROM USERS
				WHERE user_name LIKE #{user_name}
				AND user_num NOT LIKE 'admin'
		</select>
		
		<!-- 부서 추가 -->
		<insert id = "addDept">
				INSERT INTO DEPARTMENT(dept_num, dept_name, dept_tel)
				VALUES(#{dept_num}, #{dept_name}, #{dept_tel})
		</insert>
		
		<!-- 부서 수정 기능 -->
		<update id = "updateDept">
				UPDATE DEPARTMENT 
				SET dept_name = #{dept_name}, dept_tel = #{dept_tel}
				WHERE dept_num = #{dept_num}
		</update>
		
		<!-- 부서 삭제 기능 -->
		<delete id = "deleteDept">
				DELETE FROM  DEPARTMENT
				WHERE dept_num = #{dept_num}
		</delete>
		
		<!-- 부서 검색 기능 -->
		<select id = "searchDept" resultType = "Department">
				SELECT *
				FROM DEPARTMENT
				WHERE dept_name LIKE #{dept_name}
		</select>
		
		<!-- 부서 권한 수정 -->
		<update id = "auth_update">
			UPDATE DEPARTMENT 
			SET
				auth_sales 			= #{auth_sales}, 
				auth_salesList 		= #{auth_salesList}, 
				auth_clients 			=  #{auth_clients}, 
				auth_orders 			=  #{auth_orders}, 
				auth_supplier 		=  #{auth_supplier}, 
				auth_product 		=  #{auth_product}, 
				auth_accounting 	=  #{auth_accounting}
			WHERE dept_num =  #{dept_num};
		</update>

		
		
		<!-- 제품(Product) -->
		
		<!-- 제품 리스트 불러오기 기능 -->
		<select id="getProductList" resultType= "Product">
			SELECT *
			FROM PRODUCT
		</select>
		
		<!-- 제품  검색 기능(제품명 기준) -->
		<select id="searchProduct" resultType= "Product">
			SELECT *
			FROM PRODUCT
			WHERE pro_name LIKE #{pro_name}
		</select>
		
	
		<!-- 공급처(Supplier) -->
		
		<!-- 공급처 리스트 불러오기 기능 -->
		<select id = "getSupplier" resultType = "Supplier">
			SELECT *
			FROM SUPPLIER
		</select>
		
		<!-- 공급처 검색 기능(공급처 명 기준) -->
		<select id="searchSupplier" resultType = "Supplier">
			SELECT *
			FROM SUPPLIER
			WHERE supp_id LIKE #{supp_id}
		</select>
		
</mapper>